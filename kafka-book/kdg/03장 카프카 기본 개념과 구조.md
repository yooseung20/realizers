# ì¹´í”„ì¹´ì˜ ê¸°ë³¸ êµ¬ì„±ìš”ì†Œ
<hr>

#### ì£¼í‚¤í¼ 

- ë¶„ì‚° ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ë¥¼ í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì½”ë””ë„¤ì´ì…˜ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
- ì£¼í‚¤í¼ê°€ ë‹¤ìš´ë˜ë©´ ë¶„ì‚° ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ê°€ ë‹¤ìš´ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì•ˆì •ì„±ì„ í™•ë³´í•˜ê¸° ìœ„í•´ í´ëŸ¬ìŠ¤í„°ë¡œ êµ¬ì¶•í•©ë‹ˆë‹¤.
- ì£¼í‚¤í¼ì—ëŠ” ì¹´í”„ì¹´(ë¸Œë¡œì»¤)ì˜ ë©”íƒ€ ë°ì´í„°ë‚˜ ë¸Œë¡œì»¤ì˜ í—¬ìŠ¤ ì²´í¬ë¥¼ ë‹´ë‹¹í•©ë‹ˆë‹¤.

#### ì¹´í”„ì¹´(ë¸Œë¡œì»¤)

- ë©”ì‹œì§€(ë ˆì½”ë“œ)ë¥¼ ê´€ë¦¬í•˜ëŠ” ì„œë²„, ì—¬ëŸ¬ëŒ€ì˜ ë¸Œë¡œì»¤ë¡œ í´ëŸ¬ìŠ¤í„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### í”„ë¡œë“€ì„œ

- ë©”ì‹œì§€ë¥¼ ë°œì†¡í•˜ëŠ” ì„œë²„

#### ì»¨ìŠˆë¨¸

- ë©”ì‹œì§€ë¥¼ ì†Œë¹„í•˜ëŠ” ì„œë²„

#### í† í”½

- í”„ë¡œíŠœì„œì™€ ì»¨ìŠˆë¨¸ê°€ ì†Œí†µí•˜ëŠ” ì°½êµ¬ì˜ ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
- í† í”½ì˜ ì´ë¦„ì€ ì¹´í”„ì¹´ë‚´ì—ì„œ ìœ ë‹ˆí¬í•´ì•¼í•©ë‹ˆë‹¤.

#### íŒŒí‹°ì…˜

- í•˜ë‚˜ì˜ í† í”½ë‚´ì— ë¬¼ë¦¬ì ìœ¼ë¡œ ë‚˜ë‰œ ì˜ì—­ì…ë‹ˆë‹¤.
- ì¹´í”„ì¹´ëŠ” íŒŒí‹°ì…˜ì„ í†µí•´ ê°•ë ¥í•œ ë³‘ë ¬ ì²˜ë¦¬ ë° ê³ ì„±ëŠ¥ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ì„¸ê·¸ë¨¼íŠ¸

- í”„ë¡œë“€ì„œê°€ ì „ì†¡í•œ ë©”ì‹œì§€ê°€ ë¸Œë¡œì»¤ì˜ ë¡œì»¬ ë””ìŠ¤í¬ì— ì €ì¥ë˜ëŠ” íŒŒì¼ì…ë‹ˆë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-26 á„‹á…©á„’á…® 10 08 36](https://github.com/kdg0209/realizers/assets/80187200/d1709322-71e1-44fa-83ae-ff7eded17c74)

#### ë©”ì‹œì§€(ë ˆì½”ë“œ)

- í”„ë¡œë“€ì„œê°€ ë¸Œë¡œì»¤ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê±°ë‚˜, ì»¨ìŠˆë¨¸ê°€ ì½ì–´ê°€ëŠ” ë°ì´í„° ì¡°ê°ì…ë‹ˆë‹¤.

<br>

# ë¦¬í”Œë¦¬ì¼€ì´ì…˜
<hr>

- ì•„ë˜ ëª…ë ¹ì–´ëŠ” test-m-topic í† í”½ì„ ìƒì„±í•˜ë©° íŒŒí‹°ì…˜ì˜ ìˆ˜ëŠ” 3ê°œ, ë¦¬í”Œë¦¬ì¼€ì´ì…˜ì€ 3ê°œë¥¼ ìœ ì§€í•˜ê² ë‹¤ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤.
- Isrì„ ë³´ë©´ í˜„ì¬ ë™ê¸°í™”ë˜ê³  ìˆëŠ” ë¦¬í”Œë¦¬ì¼€ì´ì…˜ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- Replicasë¥¼ ë³´ë©´ í˜„ì¬ íŒŒí‹°ì…˜ì´ ë³µì œë˜ê³  ìˆëŠ” ë¸Œë¡œì»¤ì˜ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- LeaderëŠ” í”„ë¡œë“€ì„œ, ì»¨ìŠˆë¨¸ë¡œë¶€í„° ì˜¤ëŠ” ì½ê¸°ì™€ ì“°ê¸° ìš”ì²­ì„ ì²˜ë¦¬í•˜ë©°, FollowerëŠ” ì˜¤ì§ Leaderë¡œë¶€í„° ë¦¬í”Œë¦¬ì¼€ì´ì…˜í•˜ê²Œ ë©ë‹ˆë‹¤.
```
1. kafka-topics --bootstrap-server localhost:9092 --create --topic test-m-topic --partitions 3 --replication-factor 3
2. kafka-topics --bootstrap-server localhost:9092 --describe --topic test-m-topic
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-26 á„‹á…©á„’á…® 10 58 42](https://github.com/kdg0209/realizers/assets/80187200/874291d6-fd6f-498c-904a-10250b090568)

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-26 á„‹á…©á„’á…® 11 30 29](https://github.com/kdg0209/realizers/assets/80187200/48aeb0e7-6bd8-4369-83af-47762b1419ef)

<br>

#### ğŸ¤” ë©€í‹° ë¸Œë¡œì»¤ í™˜ê²½ì—ì„œ replication-factor ì˜µì…˜ì„ ì£¼ì§€ ì•Šê³  í† í”½ì„ ë§Œë“¤ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

- Replicas, Isrì˜ ì •ë³´ë¥¼ í† ëŒ€ë¡œ íŒŒí‹°ì…˜ì´ ë³µì œë˜ê±°ë‚˜, ë™ê¸°í™” ì¤‘ì¸ ë¸Œë¡œì»¤ê°€ ì—†ìŠµë‹ˆë‹¤.
```
1. kafka-topics --bootstrap-server localhost:9092 --create --topic test-2-m-topic --partitions 2
2. kafka-topics --bootstrap-server localhost:9092 --describe --topic test-2-m-topic
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-26 á„‹á…©á„’á…® 11 16 11](https://github.com/kdg0209/realizers/assets/80187200/14b0831a-3824-4a3e-986e-d90cd754fd1d)

<br>

# íŒŒí‹°ì…˜
<hr>

- í•˜ë‚˜ì˜ í† í”½ì´ í•œë²ˆì— ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” í•œê³„ë¥¼ ë†’ì´ê¸° ìœ„í•´ í•˜ë‚˜ì˜ í† í”½ì„ ì—¬ëŸ¬ê°œì˜ ë¬¼ë¦¬ì  ì˜ì—­ìœ¼ë¡œ ë‚˜ëˆˆê²ƒì„ íŒŒí‹°ì…˜ì´ë¼ í•©ë‹ˆë‹¤.
- íŒŒí‹°ì…˜ ìˆ˜ëŠ” ì´ˆê¸° ìƒì„±ì‹œ ì–¼ë§ˆë“ ì§€ ëŠ˜ë¦´ ìˆ˜ ìˆì§€ë§Œ, ë°˜ëŒ€ë¡œ ëŠ˜ë¦° íŒŒí‹°ì…˜ì€ ë‹¤ì‹œ ì¤„ì¼ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì‹ ì¤‘í•´ì•¼ í•©ë‹ˆë‹¤.
- ì²˜ìŒ íŒŒí‹°ì…˜ìˆ˜ë¥¼ ì ê²Œ ê°€ì ¸ê°€ê³ , ì»¨ìŠˆë¨¸ì˜ ë©”ì‹œì§€ ì²˜ë¦¬ëŸ‰ì„ ëª¨ë‹ˆí„°ë§í•˜ë©´ì„œ ì¡°ê¸ˆì”© ëŠ˜ë ¤ê°€ëŠ” ë°©ë²•ì´ ì¢‹ìŠµë‹ˆë‹¤.
  - ì»¨ìŠˆë¨¸ì˜ LAGë¡œ íŒŒì•…í•©ë‹ˆë‹¤.(í”„ë¡œë“€ì„œê°€ ë³´ë‚¸ ë©”ì‹œì§€ ìˆ˜ - ì»¨ìŠˆë¨¸ê°€ ê°€ì ¸ê°„ ë©”ì‹œì§€ ìˆ˜)

<br>

# ì„¸ê·¸ë¨¼íŠ¸
<hr>

- ì„¸ê·¸ë¨¼íŠ¸ë€ í”„ë¡œë“€ì„œê°€ ì „ì†¡í•œ ë©”ì‹œì§€ê°€ ë¡œì»¬ ë””ìŠ¤í¬ì— ì €ì¥ë˜ëŠ” íŒŒì¼ì…ë‹ˆë‹¤. 0X20.log
- â­ï¸ ì°¸ê³ : Keyê°€ ì—†ëŠ” ë©”ì‹œì§€ëŠ” íŒŒí‹°ì…˜ì´ ì—¬ëŸ¬ê°œì¸ ê²½ìš° ìˆœì„œë³´ì¥ì„ í•  ìˆ˜ ì—†ìŒ. 
```
// ë©”ì‹œì§€ í”„ë¡œë“€ì„œ 
1. kafka-console-producer --bootstrap-server localhost:9092 --topic test-m-topic --property key.separator=: --property parse.key=true

// ë©”ì‹œì§€ ì»¨ìŠˆë¨¸
2. kafka-console-consumer --bootstrap-server localhost:9092 --topic test-m-topic --property print.key=true --property print.value=true --property print.partition=true --from-beginning

// ì„¸ê·¸ë¨¼íŠ¸ ì¡°íšŒ
3. kafka-dump-log --deep-iteration --files 00000000000000000000.log --print-data-log
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-26 á„‹á…©á„’á…® 11 53 47](https://github.com/kdg0209/realizers/assets/80187200/2053ede0-a981-45fc-8b65-11d18b7174c1)

<br>

# ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œ ëª¨ë“  ë¸Œë¡œì»¤ ì„œë²„ê°€ ì£½ìœ¼ë©´?
<hr>

- ì¹´í”„ì¹´ í´ëŸ¬ìŠ¤í„°ë‚´ì— ë¸Œë¡œì»¤ 1, 2, 3ì´ ìˆì—ˆëŠ”ë° ì´ˆë¡ìƒ‰ ë©”ì‹œì§€ë¥¼ Leader/Followerì—ê²Œ ëª¨ë‘ ì „ë‹¬í•˜ì˜€ê³ , 5ì´ˆ ë’¤ì— ë¸Œë¡œì»¤ 3ì´ ë‹¤ìš´ë˜ì–´ ì¹´í”„ì¹´ í´ëŸ¬ìŠ¤í„°ë‚´ì—ëŠ” ë¸Œë¡œì»¤ 1, 2ë§Œ ë‚¨ì•„ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
  
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-27 á„‹á…©á„Œá…¥á†« 12 19 09](https://github.com/kdg0209/realizers/assets/80187200/48ee8886-639f-496b-bd3c-aec97e5f6192)

- ì‹œê°„ì´ í˜ëŸ¬ íŒŒë€ìƒ‰ ë©”ì‹œì§€ë¥¼ Leader/Followerì—ê²Œ ëª¨ë‘ ì „ë‹¬í•˜ì˜€ê³ , 3ì´ˆ ë’¤ì— ë¸Œë¡œì»¤ 2ê°€ ë‹¤ìš´ë˜ì–´ ì¹´í”„ì¹´ í´ëŸ¬ìŠ¤í„°ë‚´ì—ëŠ” ë¸Œë¡œì»¤ 1ë§Œ ë‚¨ì•„ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-27 á„‹á…©á„Œá…¥á†« 12 23 04](https://github.com/kdg0209/realizers/assets/80187200/137d1b8e-5a91-400b-bac0-93e5016cf89d)

- ë˜ ì‹œê°„ì´ í˜ëŸ¬ ìì£¼ìƒ‰ ë©”ì‹œì§€ë¥¼ Leaderì—ê²Œë§Œ ì „ë‹¬ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  1ì´ˆ í›„ì— Leader ë¸Œë¡œì»¤ ë§ˆì ¸ ë‹¤ìš´ì´ ë˜ì–´ ì¹´í”„ì¹´ í´ëŸ¬ìŠ¤í„°ë‚´ì—ëŠ” ì‹¤í–‰ì¤‘ì¸ ë¸Œë¡œì»¤ê°€ ì—†ê²Œë˜ëŠ”ë° ì´ë•Œ 2ê°€ì§€ ëŒ€ì‘ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-27 á„‹á…©á„Œá…¥á†« 12 25 05](https://github.com/kdg0209/realizers/assets/80187200/ddcf7849-23c4-4141-8cbf-9d8b0d776420)


### ğŸ’¡ ëŒ€ì‘ ë°©ë²•

1. ë§ˆì§€ë§‰ê¹Œì§€ Leaderì˜€ë˜ ë¸Œë¡œì»¤ 1ì´ ë‹¤ì‹œ ì‹¤í–‰ë˜ê³ , Leaderê°€ ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
2. Leader/Follower ìƒê´€ì—†ì´ ê°€ì¥ ë¨¼ì € ì‹¤í–‰ë˜ëŠ” ë¸Œë¡œì»¤ê°€ ë¦¬ë”ê°€ ë©ë‹ˆë‹¤.
3. â­ï¸ ì°¸ê³ : ì¹´í”„ì¹´ëŠ” ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ 2ë²ˆ ë°©ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

#### 1ë²ˆ ë°©ë²•

- 1ë²ˆ ë°©ë²•ì„ ì‚¬ìš©í•œë‹¤ë©´ ë°ì´í„° ì†ì‹¤ì´ ê°€ì¥ ì ìœ¼ë‚˜, ë¬´ì¡°ê±´ ë¸Œë¡œì»¤ 1ì´ ë¨¼ì € ì‹¤í–‰ë˜ì–´ì•¼í•˜ëŠ” ì¡°ê±´ì´ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ë¸Œë¡œì»¤ 1ì´ ê²°í•¨ì´ ìƒê²¨ ë°”ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë” í° ë¬¸ì œë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### 2ë²ˆ ë°©ë²•

- 2ë²ˆ ë°©ë²•ì€ ê°€ì¥ ë¹¨ë¦¬ ì¥ì• ì— ëŒ€ì‘ê°€ëŠ¥í•˜ì§€ë§Œ ë°ì´í„° ì†ì‹¤ì´ ê°€ì¥ í¬ê²Œ ë°œìƒí•©ë‹ˆë‹¤.

<br>

# Page Cache
<hr>

### ìˆœì°¨ I/O

- ë””ìŠ¤í¬ì— ìˆœì°¨ì ìœ¼ë¡œ ì ‘ê·¼í•˜ëŠ” ìˆœì°¨ I/OëŠ” Random Accessì— ë¹„í•´ 150,000ë°° ë¹ ë¥´ë‹¤ê³  í•©ë‹ˆë‹¤.
- ì„¸ê·¸ë¨¼íŠ¸ íŒŒì¼ì˜ ìë£Œ êµ¬ì¡°ëŠ” ë©”ì‹œì§€ê°€ ì¤‘ê°„ì— ì‚½ì…ë˜ì§€ ì•Šê³ , ì˜¤ë¡œì§€ ëì—ë§Œ ì €ì¥ë˜ëŠ” append-onlyì˜ íŠ¹ì„±ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
- ì„¸ê·¸ë¨¼íŠ¸ì— ì“°ì—¬ì§„ ë©”ì‹œì§€(ë ˆì½”ë“œ)ëŠ” ìˆ˜ì •ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.
- ì¹´í”„ì¹´ëŠ” Zero-Copyë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ context-switchì˜ ë°œìƒ íšŸìˆ˜ë¥¼ ì¤„ì´ê³ , ì„±ëŠ¥ì„ ê°œì„ í•˜ì˜€ìŠµë‹ˆë‹¤.
  - https://velog.io/@jinii/%EC%A0%9C%EB%A1%9C%EC%B9%B4%ED%94%BCzero-copy

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-27 á„‹á…©á„Œá…¥á†« 11 01 22](https://github.com/kdg0209/realizers/assets/80187200/e85df68d-3081-44c1-a0ef-b8a7f9f11513)

<br>

# ë°°ì¹˜ ì „ì†¡ ë° ì••ì¶• ì „ì†¡
<hr>

- í”„ë¡œë“€ì„œì—ì„œ send ë©”ì„œë“œ í˜¸ì¶œ ì‹œ KafkaProducer.classì˜ send ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê²Œ ë©ë‹ˆë‹¤.
- ë‚´ë¶€ì—ì„œ Serializerê°€ ìˆ˜í–‰ë˜ì–´ ì••ì¶•ì´ ë˜ë©°, íŒŒí‹°ì…”ë‹ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.
- ê·¸ë¦¬ê³  RecordAccumulrator í´ë˜ìŠ¤ì˜ append ë©”ì„œë“œê°€ í˜¸ì¶œë˜ë©° ë°°ì¹˜ë¡œ ë‹´ê¸°ê²Œ ë©ë‹ˆë‹¤.
- ê·¸ë¦¬ê³  ë³„ê°œì˜ Sender ìŠ¤ë ˆë“œëŠ” RecordAccumulatorì— ë°°ì¹˜ë¡œ ì €ì¥ëœ ë°ì´í„°ë¥¼ drain ë©”ì„œë“œë¡œ êº¼ë‚´ kafka clusterë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.(Sender.class ë‚´ë¶€ì ìœ¼ë¡œ ì´ë£¨ì–´ì§)

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-27 á„‹á…©á„’á…® 12 58 07](https://github.com/kdg0209/realizers/assets/80187200/172adbd2-4e43-43d4-a2a9-361e39941be6)

<br>

# Producer
<hr>

- ProducerëŠ” ë©”ì‹œì§€ë¥¼ ë§¤ë²ˆ ë¸Œë¡œì»¤ì—ê²Œ ì „ì†¡í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ë°°ì¹˜ ë‹¨ìœ„ë¡œ ì „ì†¡í•˜ê²Œ ë©ë‹ˆë‹¤. (RecordAccumulator)
- í”„ë¡œë“€ì„œì˜ ì˜µì…˜ê°’ ì¤‘ì—ì„œ buffer.memory ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë¸Œë¡œì»¤ë¡œ ë°ì´í„°ë¥¼ ë³´ë‚´ê¸°ì „ì— ì–´ëŠì •ë„ ë‹´ê²¨ì•¼ ë³´ë‚¼ì§€ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ê¸°ë³¸ê°’: 33554432)
- linger.ms ì˜µì…˜ì„ í†µí•´ buffer.memoryì˜ ì„¤ì •ê°’ ë§Œí¼ ê°€ë“ì°¨ì§€ ì•Šì•„ë„ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆê²Œë©ë‹ˆë‹¤.
- ë§Œì•½ linger.msë³´ë‹¤ ë‚®ì€ ì‹œê°„ì— buffer.memoryê°€ ê°€ë“ì°¼ë‹¤ë©´ ë°”ë¡œ ë©”ì‹œì§€ë¥¼ ë¸Œë¡œì»¤ì—ê²Œ ì „ë‹¬í•˜ê²Œ ë©ë‹ˆë‹¤.

  
### ë©”ì‹œì§€ ë³´ë‚´ê³  í™•ì¸í•˜ì§€ ì•Šê¸°

- ì‹¤ì œ ìš´ì˜í™˜ê²½ì—ì„œ ì¶”ì²œí•˜ì§€ ì•Šì§€ë§Œ, ì¹´í”„ì¹´ëŠ” í•­ìƒ ì‚´ì•„ ìˆê³  í”„ë¡œë“€ì„œ ë˜í•œ ìë™ìœ¼ë¡œ ì¬ì‹œì‘í•˜ë¯€ë¡œ ëŒ€ë¶€ë¶„ì€ ì„±ê³µì ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ë°œì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
public class Producer {

    private static final String BOOTSTRAP_SERVERS_CONFIG = "localhost:9092";
    private static final String TOPIC_NAME = "welcome-topic";

    public static void main(String[] args) {
        var properties = new Properties();
        properties.setProperty(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, BOOTSTRAP_SERVERS_CONFIG);
        properties.setProperty(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());
        properties.setProperty(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());

        KafkaProducer<String, String> kafkaProducer = new KafkaProducer<>(properties);

        try {
            for (int i = 0; i < 5; i++) {
                String key = "user" + i;
                String value = "message " + i;
                ProducerRecord<String, String> record = new ProducerRecord<>(TOPIC_NAME, key, value);
                kafkaProducer.send(record);
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            kafkaProducer.close();
        }
    }
}
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-27 á„‹á…©á„’á…® 1 32 55](https://github.com/kdg0209/realizers/assets/80187200/9012c6fc-4a4e-4f34-b567-9b0bb2a75076)

### ë™ê¸° ì „ì†¡

- ë©”ì‹œì§€ ì „ì†¡ì˜ ì‹ ë¢°ì„±ì€ ì–»ì„ ìˆ˜ ìˆì§€ë§Œ ë³´ë‚¸ ë©”ì‹œì§€ì— ì‘ë‹µì„ ê¸°ë‹¤ë ¤ì•¼í•˜ë¯€ë¡œ ë§ì€ ì‹œê°„ì„ ì†Œë¹„í•˜ê²Œ ë˜ê³  ë¹ ë¥¸ ì „ì†¡ì„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
  
```java
public class Producer {

    public static final Logger LOGGER = LoggerFactory.getLogger(Producer.class.getName());
    private static final String BOOTSTRAP_SERVERS_CONFIG = "localhost:9092";
    private static final String TOPIC_NAME = "welcome-topic";

    public static void main(String[] args) {
        var properties = new Properties();
        properties.setProperty(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, BOOTSTRAP_SERVERS_CONFIG);
        properties.setProperty(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());
        properties.setProperty(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());

        KafkaProducer<String, String> kafkaProducer = new KafkaProducer<>(properties);

        try {
            for (int i = 0; i < 5; i++) {
                String key = "user" + i;
                String value = "message " + i;
                ProducerRecord<String, String> record = new ProducerRecord<>(TOPIC_NAME, key, value);
                RecordMetadata metadata = kafkaProducer.send(record).get();

                LOGGER.info("topic: {}, partition: {}, offset: {}",
                        metadata.topic(),
                        metadata.partition(),
                        metadata.offset());
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            kafkaProducer.close();
        }
    }
}

```

### ë¹„ë™ê¸° ì „ì†¡

- ë¹ ë¥¸ ì „ì†¡ì´ ê°€ëŠ¥í•˜ê³ , ë©”ì‹œì§€ ì „ì†¡ì´ ì‹¤íŒ¨í•œ ê²½ìš° ì½œë°±ìœ¼ë¡œ ëŒ€ì²˜ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
public class Producer {

    public static final Logger LOGGER = LoggerFactory.getLogger(Producer.class.getName());
    private static final String BOOTSTRAP_SERVERS_CONFIG = "localhost:9092";
    private static final String TOPIC_NAME = "welcome-topic";

    public static void main(String[] args) {
        var properties = new Properties();
        properties.setProperty(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, BOOTSTRAP_SERVERS_CONFIG);
        properties.setProperty(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());
        properties.setProperty(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());

        KafkaProducer<String, String> kafkaProducer = new KafkaProducer<>(properties);

        try {
            for (int i = 0; i < 5; i++) {
                String key = "user" + i;
                String value = "message " + i;
                ProducerRecord<String, String> record = new ProducerRecord<>(TOPIC_NAME, key, value);
                kafkaProducer.send(record, new Callback() {
                    @Override
                    public void onCompletion(RecordMetadata metadata, Exception exception) {
                        LOGGER.info("topic: {}, partition: {}, offset: {}", metadata.topic(), metadata.partition(), metadata.offset());
                    }
                });
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            kafkaProducer.close();
        }
    }
}
```

<br>

# Consumer
<hr>

- ì»¨ìŠˆë¨¸ëŠ” ë°˜ë“œì‹œ ì»¨ìŠˆë¨¸ ê·¸ë£¹ì— ì†í•˜ê²Œ ë©ë‹ˆë‹¤.
- ì»¨ìŠˆë¨¸ ê·¸ë£¹ì´ë€ í•˜ë‚˜ ì´ìƒì˜ ì»¨ìŠˆë¨¸ë“¤ì´ ëª¨ì—¬ìˆëŠ” ê·¸ë£¹ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
- ì´ìƒì ì¸ ì»¨ìŠˆë¨¸ ìˆ˜ëŠ” íŒŒí‹°ì…˜ ìˆ˜ì™€ ì¼ëŒ€ì¼ ë§¤ì¹­ë˜ëŠ”ê²Œ ì´ìƒì ì…ë‹ˆë‹¤.

### Auto Commit ë°©ì‹

- auto commitì€ ê¸°ë³¸ê°’ìœ¼ë¡œ ê°€ì¥ ë§ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.
- auto commitì€ ì˜¤í”„ì…‹ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì»¤ë°‹í•˜ë¯€ë¡œ ê´€ë¦¬ìê°€ ì˜¤í”„ì…‹ì„ ë”°ë¡œ ê´€ë¦¬í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ì¥ì ì´ ìˆì§€ë§Œ, ì»¨ìŠˆë¨¸ê°€ ë¹ˆë²ˆíˆ ì¢…ë£Œë˜ë©´ ì¼ë¶€ ë©”ì‹œì§€ë¥¼ ëª» ê°€ì ¸ì˜¤ê±°ë‚˜, ì¤‘ë³µ ë©”ì‹œì§€ë¥¼ ì†Œë¹„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
public class Consumer {

    public static final Logger LOGGER = LoggerFactory.getLogger(Consumer.class.getName());
    private static final String BOOTSTRAP_SERVERS_CONFIG = "localhost:9092";
    private static final String GROUP_NAME = "welcome-group";
    private static final String TOPIC_NAME = "welcome-topic";

    public static void main(String[] args) {

        Properties properties = new Properties();
        properties.setProperty(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, BOOTSTRAP_SERVERS_CONFIG);
        properties.setProperty(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
        properties.setProperty(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
        properties.setProperty(ConsumerConfig.GROUP_ID_CONFIG, GROUP_NAME);

        KafkaConsumer<String, String> consumer = new KafkaConsumer<>(properties);
        consumer.subscribe(List.of(TOPIC_NAME));

        // poll
        while (true) {
            ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(1000L));

            for (ConsumerRecord<String, String> record : records) {
                LOGGER.info("topic: {}, partition: {}, offset: {}, key: {}, value: {}", record.topic(), record.partition(), record.offset(), record.key(), record.value());
            }
        }
    }
}
```

### Sync ë°©ì‹

```java
public class Consumer {

    public static final Logger LOGGER = LoggerFactory.getLogger(Consumer.class.getName());
    private static final String BOOTSTRAP_SERVERS_CONFIG = "localhost:9092";
    private static final String GROUP_NAME = "welcome-group";
    private static final String TOPIC_NAME = "welcome-topic";

    public static void main(String[] args) {

        Properties properties = new Properties();
        properties.setProperty(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, BOOTSTRAP_SERVERS_CONFIG);
        properties.setProperty(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
        properties.setProperty(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
        properties.setProperty(ConsumerConfig.GROUP_ID_CONFIG, GROUP_NAME);

        KafkaConsumer<String, String> consumer = new KafkaConsumer<>(properties);
        consumer.subscribe(List.of(TOPIC_NAME));

        try {
            while (true) {
                ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(1000L));

                for (ConsumerRecord<String, String> record : records) {
                    LOGGER.info("topic: {}, partition: {}, offset: {}, key: {}, value: {}", record.topic(), record.partition(), record.offset(), record.key(), record.value());
                }
                
               try {
                   if (records.count() > 0) {
                       consumer.commitSync();
                   }
               } catch (CommitFailedException e) {
                   e.printStackTrace();
               }
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            consumer.close();
        }
    }
}
```

### Async ë°©ì‹

```java
public class Consumer {

    public static final Logger LOGGER = LoggerFactory.getLogger(Consumer.class.getName());
    private static final String BOOTSTRAP_SERVERS_CONFIG = "localhost:9092";
    private static final String GROUP_NAME = "welcome-group";
    private static final String TOPIC_NAME = "welcome-topic";

    public static void main(String[] args) {

        Properties properties = new Properties();
        properties.setProperty(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, BOOTSTRAP_SERVERS_CONFIG);
        properties.setProperty(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
        properties.setProperty(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
        properties.setProperty(ConsumerConfig.GROUP_ID_CONFIG, GROUP_NAME);

        KafkaConsumer<String, String> consumer = new KafkaConsumer<>(properties);
        consumer.subscribe(List.of(TOPIC_NAME));

        try {
            while (true) {
                ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(1000L));

                for (ConsumerRecord<String, String> record : records) {
                    LOGGER.info("topic: {}, partition: {}, offset: {}, key: {}, value: {}", record.topic(), record.partition(), record.offset(), record.key(), record.value());
                }
                consumer.commitAsync((offsets, exception) -> {
                    if (exception != null) {
                        LOGGER.error("offsets: {} is not completed, error: {}", offsets, exception);
                    } else {
                        for (Map.Entry<TopicPartition, OffsetAndMetadata> entry : offsets.entrySet()) {
                            LOGGER.info("topic: {}, partition: {}, offset: {}, metadata: {}", entry.getKey().topic(), entry.getKey().partition(), entry.getValue().offset(), entry.getValue().metadata());
                        }
                    }
                });
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            consumer.close();
        }
    }
}
```

<br>

# ë¦¬ë°¸ëŸ°ì‹±ì„ ìœ„í•´ hook ì„¤ì •í•œ Consumer
<hr>

```
// íŒŒí‹°ì…˜ 3ê°œì¸ í† í”½ ìƒì„±
1. kafka-topics --bootstrap-server localhost:9092 --create --topic multi-partition-topic --partitions 3

2. ë¡œì»¬ PCì—ì„œ í•˜ë‚˜ì˜ Producer ì„œë²„ì™€ 3ê°œì˜ Consumer ì„œë²„ ê°€ë™
```

#### Producer ì„œë²„ëŠ” ë©”ì‹œì§€ë¥¼ 3ê°œì˜ íŒŒí‹°ì…˜ìœ¼ë¡œ ë³´ëƒ„

- ì•„ë˜ ë¡œê·¸ë¥¼ ë³´ë©´ 3ê°œì˜ íŒŒí‹°ì…˜ìœ¼ë¡œ ë©”ì‹œì§€ê°€ ë°œì†¡ë˜ëŠ”ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<img width="966" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-28 á„‹á…©á„’á…® 1 43 48" src="https://github.com/kdg0209/realizers/assets/80187200/c87f9ae9-2beb-4e07-8046-b180423ac095">

#### í•˜ë‚˜ì˜ Consumerì„œë²„ë§Œ ê°€ë™

- ì•„ë˜ ì‚¬ì§„ì€ í•˜ë‚˜ì˜ Consumer ì„œë²„ë§Œ ê°€ë™ì„ ì‹œì¼°ê³ , partition 3ê°œë¥¼ ì†Œë¹„í•˜ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<img width="965" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-28 á„‹á…©á„’á…® 1 46 14" src="https://github.com/kdg0209/realizers/assets/80187200/f5725a5b-e523-43a1-ac7a-73aeb5538f27">

#### í•˜ë‚˜ì˜ Consumer ì„œë²„ë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ê°€ë™

- ì»¨ìŠˆë¨¸ ê·¸ë£¹ì—ì„œ ë¦¬ë°¸ëŸ°ì‹±ì´ ì¼ì–´ë‚˜ ìƒˆë¡œ ì¶”ê°€ëœ Consumer ì„œë²„ë„ íŒŒí‹°ì…˜ 2ë¥¼ í• ë‹¹ë°›ì•„ ì†Œë¹„í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<img width="1019" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-28 á„‹á…©á„’á…® 1 51 29" src="https://github.com/kdg0209/realizers/assets/80187200/6326dc03-caa9-4aa0-8d69-6d1f754ee1ad">

#### ë§ˆì§€ë§‰ í•˜ë‚˜ì˜ Consumer ì„œë²„ë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ê°€ë™

- ì´ë ‡ê²Œ ë¦¬ë°¸ëŸ°ì‹± ê³¼ì •ì„ í†µí•´ ì´ 3ê°œì˜ Consumerê°€ ê°€ë™ì´ ë˜ëŠ”ê²ƒê¹Œì§€ í™•ì¸ì„ í•˜ì˜€ê³ , ì´ì œë¶€í„° Consumer ì„œë²„ê°€ ë‹¤ìš´ë ë•Œë§ˆë‹¤ ì–´ë–»ê²Œ ë˜ëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

<img width="1021" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-28 á„‹á…©á„’á…® 1 56 41" src="https://github.com/kdg0209/realizers/assets/80187200/21ffec59-1c69-4b70-b02d-15e0caf7d453">

### í•˜ë‚˜ì˜ Consumer ì„œë²„ë¥¼ ì¤‘ì§€

- í•˜ë‚˜ì˜ Consumer ì„œë²„ë¥¼ ì¤‘ì§€ì‹œì¼°ë‹¤.
- í•˜ì§€ë§Œ ë¦¬ë°¸ëŸ°ì‹±ì€ ì¦‰ì‹œ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

<img width="995" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-28 á„‹á…©á„’á…® 2 03 55" src="https://github.com/kdg0209/realizers/assets/80187200/c81bfa17-8cd9-41fa-91d3-5cf010698c81">

### Consumer ì½”ë“œ ìˆ˜ì •

```java
public class Consumer {

    private static final Logger LOGGER = LoggerFactory.getLogger(Consumer.class.getName());
    private static final String BOOTSTRAP_SERVERS_CONFIG = "localhost:9092";
    private static final String GROUP_NAME = "multi-partition-group";
    private static final String TOPIC_NAME = "multi-partition-topic";

    public static void main(String[] args) {

        Properties properties = new Properties();
        properties.setProperty(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, BOOTSTRAP_SERVERS_CONFIG);
        properties.setProperty(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
        properties.setProperty(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
        properties.setProperty(ConsumerConfig.GROUP_ID_CONFIG, GROUP_NAME);

        KafkaConsumer<String, String> consumer = new KafkaConsumer<>(properties);
        consumer.subscribe(List.of(TOPIC_NAME));

        Thread mainThread = Thread.currentThread();

        Runtime.getRuntime().addShutdownHook(new Thread(() -> {
            LOGGER.info("call hook");
            consumer.wakeup();

            try {
                mainThread.join();
            } catch (InterruptedException e) {
                LOGGER.info("main thread dead");
            }
        }));

        try {
            while (true) {
                ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(1000L));

                for (ConsumerRecord<String, String> record : records) {
                    LOGGER.info("topic: {}, partition: {}, offset: {}, key: {}, value: {}", record.topic(), record.partition(), record.offset(), record.key(), record.value());
                }
                consumer.commitAsync((offsets, exception) -> {
                    if (exception != null) {
                        LOGGER.error("offsets: {} is not completed, error: {}", offsets, exception);
                    } else {
                        for (Map.Entry<TopicPartition, OffsetAndMetadata> entry : offsets.entrySet()) {
                            LOGGER.info("topic: {}, partition: {}, offset: {}, metadata: {}", entry.getKey().topic(), entry.getKey().partition(), entry.getValue().offset(), entry.getValue().metadata());
                        }
                    }
                });
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            consumer.close();
        }
    }
}
```

- ì•„ë˜ ì‚¬ì§„ì„ ë³´ë©´ main ìŠ¤ë ˆë“œê°€ ì£½ê¸°ì „ì— ì¶”ê°€ì ì¸ ì‘ì—…ì„ í•˜ëŠ”ê²ƒì„ ë³¼ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. ì´ì „ì— í• ë‹¹ëœ íŒŒí‹°ì…˜ì„ ì·¨ì†Œí•©ë‹ˆë‹¤.
2. ì½”ë””ë„¤ì´í„°ì—ê²Œ LeaveGroupìš”ì²­ì„ ë³´ë‚´ê²Œ ë©ë‹ˆë‹¤. (ì•¼ ë‚˜ ê³§ ì£½ìœ¼ë‹ˆê¹Œ ë– ë‚ ê±°ì•¼)
3. ì •ìƒì ìœ¼ë¡œ ê·¸ë£¹ì„ íƒˆí‡´í•˜ê²Œ ë©ë‹ˆë‹¤.
4. ê·¸ëŸ¼ ì½”ë””ë„¤ì´í„°ëŠ” ë°”ë¡œ ë¦¬ë°¸ëŸ°ì‹± ì‘ì—…ì„ ë“¤ì–´ê°€ê²Œë˜ê³  ë‚˜ë¨¸ì§€ 2ê°œì˜ ConsumerëŠ” ì£½ì€ Consumerì˜ íŒŒí‹°ì…˜ì„ í• ë‹¹ë°›ì•„ ì²˜ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤.

<img width="982" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-28 á„‹á…©á„’á…® 2 12 03" src="https://github.com/kdg0209/realizers/assets/80187200/742e38b2-4ede-4a06-8805-1810a3252b72">


### ğŸ¤” ì™œ ConsumerëŠ” ì£½ì€ ì¦‰ì‹œ ì½”ë””ë„¤ì´í„°ì—ê²Œ ì•Œë¦¬ì§€ ì•Šì„ê¹Œ?

- ìš°ì„  ConsumerëŠ” heartbeat.interval.ms = 3000 ì„¤ì •ì— ì˜í•´ 3ì´ˆë§ˆë‹¤ ì½”ë””ë„¤ì´í„°ì—ê²Œ ìì‹ ì´ ì‚´ì•„ìˆë‹¤ëŠ” ê²ƒì„ ì•Œë¦½ë‹ˆë‹¤.
- ê·¸ë¦¬ê³  session.timeout.ms = 45000 ì„¤ì •ìœ¼ë¡œ ì¸í•´ 45ì´ˆ ë™ì•ˆ heartbeatë¥¼ ë³´ë‚´ì§€ ì•Šìœ¼ë©´ ê·¸ì œì„œì•¼ ë¦¬ë°¸ëŸ°ì‹±ì´ ì´ë£¨ì–´ì§€ê³  ë‹¤ë¥¸ Consumerì— íŒŒí‹°ì…˜ì„ í• ë‹¹í•˜ê²Œ ë©ë‹ˆë‹¤.

  
